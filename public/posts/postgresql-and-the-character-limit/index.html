<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>PostgreSQL and the 63-character limit | hazeol engineering blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="I recently had to set up a composite index on a model that uses Sequelize ORM to interface with PostgreSQL. Initially, the model looked like this;">
    <meta name="generator" content="Hugo 0.148.2">
    
    
    
      <meta name="robots" content="index, follow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.f2eacbe7a4fc82aa0eff14b7ad2c921609e5f69adfb6ba96a5a77cf5406923a0.css" >



  


    


    
      

    

    

    
      <link rel="canonical" href="https://engineering.hazeol.com/posts/postgresql-and-the-character-limit/">
    

    <meta property="og:url" content="https://engineering.hazeol.com/posts/postgresql-and-the-character-limit/">
  <meta property="og:site_name" content="hazeol engineering blog">
  <meta property="og:title" content="PostgreSQL and the 63-character limit">
  <meta property="og:description" content="I recently had to set up a composite index on a model that uses Sequelize ORM to interface with PostgreSQL. Initially, the model looked like this;">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-14T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-09-14T00:00:00+00:00">

  <meta itemprop="name" content="PostgreSQL and the 63-character limit">
  <meta itemprop="description" content="I recently had to set up a composite index on a model that uses Sequelize ORM to interface with PostgreSQL. Initially, the model looked like this;">
  <meta itemprop="datePublished" content="2024-09-14T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-09-14T00:00:00+00:00">
  <meta itemprop="wordCount" content="538">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="PostgreSQL and the 63-character limit">
  <meta name="twitter:description" content="I recently had to set up a composite index on a model that uses Sequelize ORM to interface with PostgreSQL. Initially, the model looked like this;">

      
    
	
  </head><body class="ma0 avenir bg-near-white production">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        hazeol engineering blog
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1">PostgreSQL and the 63-character limit</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-09-14T00:00:00Z">September 14, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>I recently had to set up a composite index on a model that uses Sequelize ORM to interface with PostgreSQL. Initially, the model looked like this;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span>, <span style="color:#a6e22e">DataTypes</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sequelize</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Sequelize</span>(<span style="color:#e6db74">&#39;database_name&#39;</span>, <span style="color:#e6db74">&#39;username&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">host</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dialect</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;postgres&#39;</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">UserAccount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sequelize</span>.<span style="color:#a6e22e">define</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;user_account&#39;</span>,
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnA</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnB</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnC</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnD</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnE</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnF</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     * @note Composite Index
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">     */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">indexes</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unique</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnA&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnB&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnC&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnD&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnE&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnF&#39;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sequelize</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">sync</span>()
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;UserAccount model has been synced with the PostgreSQL database.&#39;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Unable to sync the database:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>  });
</span></span></code></pre></div><p>Looks like this works fine right?! Well, partially.</p>
<p>In non-production environments, we use sequlize’s <a href="https://sequelize.org/docs/v7/models/model-synchronization/" target="_blank" rel="noopener">synchronizing feature</a> to automatically sync the database table with the model defined in the code. In this scenario, there’s a silent problem.</p>
<p>When sequelize synchronizes the model with the table for the first time, it works just fine. On subsequent restart of the application service, we’re going to run into an error like this;</p>
<pre tabindex="0"><code>https://sequelize.org/docs/v7/models/model-synchronization/
</code></pre><p>If you’re observant, you’ll notice that the relation that is being claimed to exist is somewhat cut out. Where did column_f go all of a sudden and why do we have colu in its place?</p>
<p>Turns out, PostgreSQL has a <a href="https://www.postgresql.org/docs/current/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS:~:text=The%20system%20uses%20no%20more%20than%20NAMEDATALEN%2D1" target="_blank" rel="noopener">63-character limit</a> that is imposed by <a href="https://pgpedia.info/n/NAMEDATALEN.html" target="_blank" rel="noopener">NAMEDATALEN</a> which is a constant that defines the maximum length of database identifiers.</p>
<p>This is a breakdown of what happens that leads to this error;</p>
<ul>
<li>During the first application start, PostgreSQL auto-generates an index name since one wasn’t provided which would be user_accounts_column_a_column_b_column_c_column_d_column_e_column_f and truncates it to user_accounts_column_a_column_b_column_c_column_d_column_e_colu considering that the auto-generated identifier name (67 character count) exceeds the character limit.</li>
<li>When the app restarts, sequelize will try to create the index again using the auto-generated index name, truncate it to 63 characters and that’s when we’d get the above error because the truncated version of this index name already exists.
To mitigate this, add a custom index name property that complies with the character limit to the composite index in the model definition. Like this;</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">Sequelize</span>, <span style="color:#a6e22e">DataTypes</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;sequelize&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">sequelize</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Sequelize</span>(<span style="color:#e6db74">&#39;database_name&#39;</span>, <span style="color:#e6db74">&#39;username&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">host</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">dialect</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;postgres&#39;</span>,
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">UserAccount</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sequelize</span>.<span style="color:#a6e22e">define</span>(
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#39;user_account&#39;</span>,
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnA</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnB</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnC</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnD</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnE</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">columnF</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">type</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">DataTypes</span>.<span style="color:#a6e22e">STRING</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">allowNull</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">indexes</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         * @note Custom Index Name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;user_accounts_columnA_columnB_columnC_columnD_columnE_columnF&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">unique</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fields</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnA&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnB&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnC&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnD&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnE&#39;</span>,
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;columnF&#39;</span>,
</span></span><span style="display:flex;"><span>        ],
</span></span><span style="display:flex;"><span>      },
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sequelize</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">sync</span>()
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>(() =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#39;UserAccount model has been synced with the PostgreSQL database.&#39;</span>
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">err</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">&#39;Unable to sync the database:&#39;</span>, <span style="color:#a6e22e">err</span>);
</span></span><span style="display:flex;"><span>  });
</span></span></code></pre></div><p>user_accounts_columnA_columnB_columnC_columnD_columnE_columnF has a character count of 61 which is just under 63 characters so we wouldn’t have a problem with database conflict on subsequent application restarts.</p><ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="https://engineering.hazeol.com/" >
    &copy;  hazeol engineering blog 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
